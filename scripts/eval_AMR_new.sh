#!/bin/bash
amcoll=$1
dir=$2 # output directory that contains
# goldAMR.txt
# This file gets generated by scripts/preprocess_AMR_test.sh

ALTO_PATH=$(readlink -f "$3")

# if these files are missing, run scripts/setup_AMR.sh
lookup="downloaded_models/lookup/lookupdata17/"
wordnet_path="downloaded_models/wordnet3.0/dict/"

echo "Evaluating to graphs and relabelling with threshold 10"

java -Xmx2G -cp "$ALTO_PATH" de.saar.coli.amrtagging.formalisms.amr.tools.EvaluateCorpus -c "$1" -o "$dir" --relabel --wn "$wordnet_path" --lookup "$lookup" --th 10

# add newlines to goldAMR.txt

sed ':a;N;$!ba;s/\n/\n\n/g' "$dir/goldAMR.txt" > "$dir/goldAMR_newlines.txt"

# compute smatch score
echo "smatching in $dir"

python2 external_eval_tools/smatch/smatch.py -f "$dir/parserOut.txt" "$dir/goldAMR_newlines.txt" --significant 4 --pr | tee $dir/smatch.txt
